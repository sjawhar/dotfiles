#!/bin/bash
# Wrapper to launch voxtype daemon with Groq API key from sops secrets
set -euo pipefail

MISE="${DOTFILES_DIR:-$HOME/.dotfiles}/bin/mise"

export VOXTYPE_WHISPER_API_KEY
VOXTYPE_WHISPER_API_KEY=$("$MISE" exec sops age -- \
    sops -d --output-type dotenv "$HOME/.dotfiles/secrets.env" \
    | grep '^GROQ_API_KEY=' | cut -d= -f2-)

exec /usr/lib/voxtype/voxtype-avx512 daemon
